<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="theme-color" content="#000000"/>
    <link rel="shortcut icon" type="image/ico" href="/src/assets/favicon.ico"/>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0"/>
    <title>Solid App</title>
</head>
<body>
<noscript>You need to enable JavaScript to run this app.</noscript>
<script>
    // global variables
    const USERNAME = "JoJo";
    const SERVER_URL = "http://0.0.0.0:8080"  // NOTE: should be obtained from .env file
    fetch(`${SERVER_URL}/user`, {
        method: "POST",
        body: JSON.stringify({username: USERNAME}),
    }).then(response => {
        if (!response.ok) {
            return Promise.reject(response);
        }
        return response.json();
    }).then(_ => {
        console.log(`Sign Up: ${USERNAME}`)
    }).catch(_ => {
        console.log(`Sign In: ${USERNAME}`)
    })

    var current_chat_id = 1;
    const dialogs = [];

    fetch(`${SERVER_URL}/chat/${USERNAME}`).then(response => {
        if (!response.ok) {
            return Promise.reject(response);
        }
        return response.json();
    }).then(async data => {
        if (data !== null) {
            let result = await data;
            current_chat_id = result[0];
            fetch(
                `${SERVER_URL}/message?chat_id=${current_chat_id}&limit=100&page=1`
            ).then(response => {
                if (!response.ok) {
                    return Promise.reject(response);
                }
                return response.json();
            }).then(async data => {
                let arr = await data;
                if (arr !== null) {
                    for (let obj of Object.values(arr)) {
                        dialogs.push(obj["question"]);
                        dialogs.push(obj["answer"]);
                    }
                }
            }).catch(error => {
                console.log(error);
            })
        } else {
            fetch(`${SERVER_URL}/chat`, {
                method: "POST",
                body: JSON.stringify({
                    username: USERNAME
                }),
            }).then(response => {
                if (!response.ok) {
                    return Promise.reject(response);
                }
                return response.json();
            }).then(async data => {
                let json = await data;
                current_chat_id = json["chat_id"];
            })
        }
    }).catch(error => {
        console.log(error)
    })

    var current_algorithm = "kmp";
</script>
<div id="root"></div>

<script src="/src/index.jsx" type="module"></script>
</body>
</html>
